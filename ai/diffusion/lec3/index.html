
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="HarryZ">
      
      
        <link rel="canonical" href="https://note.uqbarz.com/ai/diffusion/lec3/">
      
      
        <link rel="prev" href="../lec2/">
      
      
        <link rel="next" href="../lec4/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.17">
    
    
      
        <title>Lec3: Training Flow and Diffusion Models - HarryZ ã® Notebook</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/fonts.css">
    
      <link rel="stylesheet" href="../../../stylesheets/theme.css">
    
      <link rel="stylesheet" href="../../../stylesheets/counter.css">
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="slate" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#training-flow-and-diffusion-models" class="md-skip">
          è·³è½¬è‡³
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="é¡µçœ‰">
    <a href="../../.." title="HarryZ ã® Notebook" class="md-header__button md-logo" aria-label="HarryZ ã® Notebook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HarryZ ã® Notebook
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lec3: Training Flow and Diffusion Models
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="slate" data-md-color-accent="indigo"  aria-label="åˆ‡æ¢è‡³æµ…è‰²æ¨¡å¼"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="åˆ‡æ¢è‡³æµ…è‰²æ¨¡å¼" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="day" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="åˆ‡æ¢è‡³æ·±è‰²æ¨¡å¼"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="åˆ‡æ¢è‡³æ·±è‰²æ¨¡å¼" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="æ ¹æ®ç³»ç»Ÿæ¨¡å¼åˆ‡æ¢ä¸»é¢˜"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="æ ¹æ®ç³»ç»Ÿæ¨¡å¼åˆ‡æ¢ä¸»é¢˜" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="æœç´¢" placeholder="æœç´¢" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="æŸ¥æ‰¾">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="åˆ†äº«" aria-label="åˆ†äº«" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="æ¸…ç©ºå½“å‰å†…å®¹" aria-label="æ¸…ç©ºå½“å‰å†…å®¹" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            æ­£åœ¨åˆå§‹åŒ–æœç´¢å¼•æ“
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/hharryz/hharryz.github.io" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    hharryz.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="æ ‡ç­¾" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
  
  ğŸ¡ä¸»é¡µ

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../system/" class="md-tabs__link">
          
  
  
  è®¡ç®—æœºç³»ç»Ÿ

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../mlsys/" class="md-tabs__link">
          
  
  
  MLSys

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  AI

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../papers/" class="md-tabs__link">
          
  
  
  è®ºæ–‡é˜…è¯»

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../misc/" class="md-tabs__link">
          
  
  
  æ‚é¡¹

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="å¯¼èˆªæ " data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="HarryZ ã® Notebook" class="md-nav__button md-logo" aria-label="HarryZ ã® Notebook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    HarryZ ã® Notebook
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hharryz/hharryz.github.io" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    hharryz.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ğŸ¡ä¸»é¡µ
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            ğŸ¡ä¸»é¡µ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    é¦–é¡µ
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    è®¡ç®—æœºç³»ç»Ÿ
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            è®¡ç®—æœºç³»ç»Ÿ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Computer Systems
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    MLSys
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            MLSys
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mlsys/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Machine Learning Systems
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    AI
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            AI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deep Generative Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Diffusion
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Diffusion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lec1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lec1: Flow and Diffusion Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lec2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lec2: Constructing a Training Target
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Lec3: Training Flow and Diffusion Models
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Lec3: Training Flow and Diffusion Models
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="ç›®å½•">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      ç›®å½•
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#æµåŒ¹é…-flow-matching" class="md-nav__link">
    <span class="md-ellipsis">
      æµåŒ¹é… Flow Matching
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#å¾—åˆ†åŒ¹é…-score-matching" class="md-nav__link">
    <span class="md-ellipsis">
      å¾—åˆ†åŒ¹é… Score Matching
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#å»å™ªæ‰©æ•£æ¨¡å‹-denoising-diffusion-models" class="md-nav__link">
    <span class="md-ellipsis">
      å»å™ªæ‰©æ•£æ¨¡å‹ Denoising Diffusion Models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#å¦‚ä½•é˜…è¯»-diffusion-model-çš„æ–‡çŒ®" class="md-nav__link">
    <span class="md-ellipsis">
      å¦‚ä½•é˜…è¯» Diffusion Model çš„æ–‡çŒ®ï¼Ÿ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="å¦‚ä½•é˜…è¯» Diffusion Model çš„æ–‡çŒ®ï¼Ÿ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ç¦»æ•£æ—¶é—´-vs-è¿ç»­æ—¶é—´" class="md-nav__link">
    <span class="md-ellipsis">
      ç¦»æ•£æ—¶é—´ vs è¿ç»­æ—¶é—´
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ­£å‘è¿‡ç¨‹-vs-æ¦‚ç‡è·¯å¾„" class="md-nav__link">
    <span class="md-ellipsis">
      "æ­£å‘è¿‡ç¨‹" vs æ¦‚ç‡è·¯å¾„
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ—¶é—´åè½¬-vs-fokker-planck-æ–¹ç¨‹" class="md-nav__link">
    <span class="md-ellipsis">
      æ—¶é—´åè½¬ vs Fokker-Planck æ–¹ç¨‹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æµåŒ¹é…ä¸éšæœºæ’å€¼å™¨" class="md-nav__link">
    <span class="md-ellipsis">
      æµåŒ¹é…ä¸éšæœºæ’å€¼å™¨
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lec4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lec4: Building an Image Generator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    RL
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            RL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    è®ºæ–‡é˜…è¯»
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            è®ºæ–‡é˜…è¯»
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../papers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Paper Reading
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    MLSys
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            MLSys
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../papers/blitzscale/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BlitzScale: Fast and Live Large Model Autoscaling with O(1) Host Caching
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../papers/cacheblend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CacheBlend: Fast Large Language Model Serving for RAG with Cached Knowledge Fusion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../papers/mooncake/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mooncake: Trading More Storage for Less Computation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    æ‚é¡¹
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            æ‚é¡¹
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../misc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="ç›®å½•">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      ç›®å½•
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#æµåŒ¹é…-flow-matching" class="md-nav__link">
    <span class="md-ellipsis">
      æµåŒ¹é… Flow Matching
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#å¾—åˆ†åŒ¹é…-score-matching" class="md-nav__link">
    <span class="md-ellipsis">
      å¾—åˆ†åŒ¹é… Score Matching
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#å»å™ªæ‰©æ•£æ¨¡å‹-denoising-diffusion-models" class="md-nav__link">
    <span class="md-ellipsis">
      å»å™ªæ‰©æ•£æ¨¡å‹ Denoising Diffusion Models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#å¦‚ä½•é˜…è¯»-diffusion-model-çš„æ–‡çŒ®" class="md-nav__link">
    <span class="md-ellipsis">
      å¦‚ä½•é˜…è¯» Diffusion Model çš„æ–‡çŒ®ï¼Ÿ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="å¦‚ä½•é˜…è¯» Diffusion Model çš„æ–‡çŒ®ï¼Ÿ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ç¦»æ•£æ—¶é—´-vs-è¿ç»­æ—¶é—´" class="md-nav__link">
    <span class="md-ellipsis">
      ç¦»æ•£æ—¶é—´ vs è¿ç»­æ—¶é—´
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ­£å‘è¿‡ç¨‹-vs-æ¦‚ç‡è·¯å¾„" class="md-nav__link">
    <span class="md-ellipsis">
      "æ­£å‘è¿‡ç¨‹" vs æ¦‚ç‡è·¯å¾„
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ—¶é—´åè½¬-vs-fokker-planck-æ–¹ç¨‹" class="md-nav__link">
    <span class="md-ellipsis">
      æ—¶é—´åè½¬ vs Fokker-Planck æ–¹ç¨‹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æµåŒ¹é…ä¸éšæœºæ’å€¼å™¨" class="md-nav__link">
    <span class="md-ellipsis">
      æµåŒ¹é…ä¸éšæœºæ’å€¼å™¨
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  
    
      
    
    <a href="https://github.com/hharryz/hharryz.github.io/raw/main/docs/ai/diffusion/lec3.md" title="æŸ¥çœ‹æœ¬é¡µçš„æºä»£ç " class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="training-flow-and-diffusion-models">Training Flow and Diffusion Models<a class="headerlink" href="#training-flow-and-diffusion-models" title="Permanent link">&para;</a></h1>
<div class="admonition info">
<p class="admonition-title">åŠ¨æœº</p>
<p>åœ¨å‰ä¸¤èŠ‚ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•æ„å»ºä¸€ä¸ªç”Ÿæˆæ¨¡å‹ï¼Œå…¶å‘é‡åœº <span class="arithmatex">\(u^\theta_t\)</span> ç”±ç¥ç»ç½‘ç»œç»™å‡ºï¼Œå¹¶æ¨å¯¼å‡ºäº†è®­ç»ƒç›®æ ‡ <span class="arithmatex">\(u^{\text{target}}_t\)</span> çš„å…¬å¼ã€‚æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è¯´æ˜å¦‚ä½•è®­ç»ƒç¥ç»ç½‘ç»œ <span class="arithmatex">\(u^\theta_t\)</span> æ¥é€¼è¿‘è®­ç»ƒç›®æ ‡ <span class="arithmatex">\(u^{\text{target}}_t\)</span>ã€‚</p>
</div>
<h2 id="æµåŒ¹é…-flow-matching">æµåŒ¹é… Flow Matching<a class="headerlink" href="#æµåŒ¹é…-flow-matching" title="Permanent link">&para;</a></h2>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æŠŠé—®é¢˜é™åˆ¶åœ¨ ODE çš„åœºæ™¯ä¸‹æ¨å¯¼å‡º<strong>æµåŒ¹é…ï¼ˆflow matchingï¼‰</strong>çš„æ–¹æ³•ã€‚</p>
<p>ä¸€ä¸ªæµæ¨¡å‹å¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼ç»™å‡ºï¼š</p>
<div class="arithmatex">\[
X_0 \sim p_{\text{init}}, \quad dX_t = u_t^{\theta}(X_t)dt
\]</div>
<p>æœºå™¨å­¦ä¹ çš„æ–¹æ³•å°±æ˜¯å­¦ä¹ åˆ°å‚æ•° <span class="arithmatex">\(\theta\)</span>ï¼Œä½¿å¾— <span class="arithmatex">\(u_t^\theta\approx u_t^\text{target}\)</span>. æˆ‘ä»¬é€šå¸¸éœ€è¦å®šä¹‰ä¸€ä¸ªæŸå¤±å‡½æ•°ï¼Œåœ¨æµåŒ¹é…çš„è¯­å¢ƒä¸‹å°±æ˜¯ flow matching loss. ä¸€ä¸ªç›´è§‚çš„æ¥è·å¾— <span class="arithmatex">\(u_t^\theta \approx u_t^{\text{target}}\)</span> çš„æ–¹æ³•æ˜¯ä½¿ç”¨å‡æ–¹è¯¯å·®ï¼ˆmean-squared errorï¼‰ã€‚</p>
<div class="admonition info">
<p class="admonition-title">ä¸€äº› Notations</p>
<ul>
<li>æˆ‘ä»¬ç”¨ <span class="arithmatex">\(\text{Unif} = \text{Unif}[0,1]\)</span> è¡¨ç¤ºåŒºé—´ <span class="arithmatex">\([0, 1]\)</span> ä¸Šçš„å‡åŒ€åˆ†å¸ƒï¼Œç”¨ <span class="arithmatex">\(\mathbb{E}\)</span> è¡¨ç¤ºéšæœºå˜é‡çš„æœŸæœ›å€¼ã€‚</li>
<li><span class="arithmatex">\(p_t(x) = \int p_t(x|z) p_{\text{data}}(z) dz\)</span> åœ¨ä¹‹å‰å·²ç»æè¿‡ï¼Œæ˜¯è¾¹é™…æ¦‚ç‡è·¯å¾„å‡½æ•°ã€‚</li>
</ul>
</div>
<div class="arithmatex">\[
\begin{align*}
\mathcal{L}_{\text{FM}}(\theta) &amp;= \mathbb{E}_{t \sim \text{Unif}, x \sim p_t} [\|u_t^{\theta}(x) - u_t^{\text{target}}(x)\|^2] \\
&amp;\stackrel{(i)}{=} \mathbb{E}_{t \sim \text{Unif}, z \sim p_{\text{data}}, x \sim p_t(\cdot|z)} [\|u_t^{\theta}(x) - u_t^{\text{target}}(x)\|^2],
\end{align*}
\]</div>
<p>æˆ‘ä»¬å¯ä»¥è¿™æ ·æ„Ÿæ€§åœ°ç†è§£è¿™ä¸ªæŸå¤±å‡½æ•°ï¼šé¦–å…ˆï¼Œä»åŒºé—´ <span class="arithmatex">\([0, 1]\)</span> ä¸­éšæœºé‡‡æ ·ä¸€ä¸ªæ—¶é—´ <span class="arithmatex">\(t\)</span>ï¼›ç„¶åï¼Œä»æ•°æ®é›†ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªç‚¹ <span class="arithmatex">\(z\)</span>ï¼Œå¹¶ä»æ¡ä»¶åˆ†å¸ƒ <span class="arithmatex">\(p_t(\cdot | z)\)</span> ä¸­é‡‡æ ·ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡æ·»åŠ ä¸€äº›å™ªå£°ï¼‰ï¼Œå¹¶è®¡ç®—ç¥ç»ç½‘ç»œè¾“å‡ºçš„ <span class="arithmatex">\(u_t^\theta(x)\)</span>ã€‚æœ€åï¼Œè®¡ç®—ç¥ç»ç½‘ç»œè¾“å‡ºä¸è¾¹é™…å‘é‡åœº <span class="arithmatex">\(u_t^{\text{target}}(x)\)</span> ä¹‹é—´çš„å‡æ–¹è¯¯å·®ã€‚</p>
<p>ç„¶åï¼Œå¾ˆä¸å¹¸çš„äº‹æƒ…åœ¨äºï¼Œ<span class="arithmatex">\(u_t^{\text{target}}(x)\)</span> è¿‡äºå¤æ‚ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•ç”¨å®ƒæ¥è¿›è¡Œè®¡ç®—ã€‚<strong>ä½†æ˜¯</strong>ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒè½¬åŒ–ä¸ºæ¡ä»¶å‘é‡åœº <span class="arithmatex">\(u_t^{\text{target}}(x|z)\)</span>ï¼Œè€Œåè€…æ˜¯ç›¸å¯¹å®¹æ˜“è®¡ç®—çš„ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬ç»™å‡ºä¸€ä¸ªæ–°çš„æŸå¤±å‡½æ•°ã€‚</p>
<div class="arithmatex">\[
\mathcal{L}_{\text{CFM}}(\theta) = \mathbb{E}_{t \sim \text{Unif}, z \sim p_{\text{data}}, x \sim p_t(\cdot|z)} [\| u_t^{\theta}(x) - u_t^{\text{target}}(x|z) \|^2].
\]</div>
<p>è¿™ä¸ªæ–°çš„æŸå¤±å‡½æ•°èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å®ç°ï¼šé€šè¿‡æ˜¾å¼åœ°å›å½’å¯å¤„ç†çš„<strong>æ¡ä»¶å‘é‡åœº</strong>ï¼Œæ¥éšå¼åœ°å›å½’éš¾ä»¥å¤„ç†çš„<strong>è¾¹é™…å‘é‡åœº</strong>ã€‚è€Œè¿™ä¸€ç‚¹ä¹‹æ‰€ä»¥èƒ½å¤Ÿæˆç«‹ï¼Œæˆ‘ä»¬éœ€è¦å®šç†çš„æ”¯æ’‘ï¼Œä¸‹é¢æˆ‘ä»¬ç»™å‡ºè¿™ä¸ªå®šç†ã€‚</p>
<div class="admonition info">
<p class="admonition-title">å®šç†</p>
<p>è¾¹é™…æµåŒ¹é…æŸå¤±ï¼ˆmarginal flow matching lossï¼‰ä¸æ¡ä»¶æµåŒ¹é…æŸå¤±ï¼ˆconditional flow matching lossï¼‰ä»…ç›¸å·®ä¸€ä¸ªå¸¸æ•°ï¼Œå³ï¼š</p>
<div class="arithmatex">\[
\mathcal{L}_{FM}(\theta) = \mathcal{L}_{CFM}(\theta) + C
\]</div>
<p>å…¶ä¸­ C æ˜¯ä¸€ä¸ªä¸å‚æ•° <span class="arithmatex">\(\theta\)</span> æ— å…³çš„å¸¸æ•°ã€‚å› æ­¤ï¼Œå®ƒä»¬çš„æ¢¯åº¦æ˜¯ç›¸åŒçš„ï¼š</p>
<div class="arithmatex">\[
\nabla_{\theta}\mathcal{L}_{FM}(\theta)=\nabla_{\theta}\mathcal{L}_{CFM}(\theta)
\]</div>
<p>è¿™æ„å‘³ç€ï¼Œé€šè¿‡éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆSGDï¼‰ç­‰æ–¹æ³•æœ€å°åŒ– <span class="arithmatex">\(\mathcal{L}_{CFM}(\theta)\)</span>ï¼Œå…¶æ•ˆæœç­‰åŒäºæœ€å°åŒ– <span class="arithmatex">\(\mathcal{L}_{FM}(\theta)\)</span>ã€‚ç‰¹åˆ«åœ°ï¼Œå¯¹äº <span class="arithmatex">\(\mathcal{L}_{CFM}(\theta)\)</span> çš„æœ€ä¼˜è§£ <span class="arithmatex">\(\theta^{*}\)</span>ï¼Œåœ¨æ¨¡å‹å…·æœ‰æ— é™è¡¨è¾¾èƒ½åŠ›çš„å‰æä¸‹ï¼Œå®ƒå°†æ»¡è¶³ <span class="arithmatex">\(u_{t}^{\theta^{*}} = u_{t}^{target}\)</span>ã€‚</p>
<p>æˆ‘ä»¬åœ¨è¿™é‡Œä¸ç»™å‡ºå®šç†çš„è¯æ˜ã€‚</p>
</div>
<p>åœ¨ç†è®ºåŸºç¡€å®Œå¤‡ä¹‹åï¼Œæˆ‘ä»¬ä»¥é«˜æ–¯æ¡ä»¶æ¦‚ç‡è·¯å¾„ä¸ºä¾‹ç»™å‡ºä¸€ä¸ªæµåŒ¹é…çš„ä¾‹å­ã€‚</p>
<p>æˆ‘ä»¬å·²ç»å¤šæ¬¡ç»™å‡ºäº†é«˜æ–¯æ¦‚ç‡è·¯å¾„çš„å…¬å¼åŒ–æè¿°ï¼š<span class="arithmatex">\(p_t(\cdot|z) = \mathcal{N}(\alpha_t z; \beta_t^2 I_d)\)</span>ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬ç»™å‡ºä¸€ç§ä»é«˜æ–¯æ¦‚ç‡è·¯å¾„é‡‡æ · <span class="arithmatex">\(x_t\)</span> çš„æ–¹æ³•ï¼š</p>
<div class="arithmatex">\[
\epsilon \sim \mathcal{N}(0, I_d) \quad \Rightarrow \quad x_t = \alpha_t z + \beta_t \epsilon \sim \mathcal{N}(\alpha_t z, \beta_t^2 I_d) = p_t(\cdot|z)
\]</div>
<details class="warning">
<summary>å¤ä¹ æ¦‚ç‡è®ºï¼</summary>
<p>P.S. ä¸ºä»€ä¹ˆè¿™æ ·é‡‡æ ·æˆç«‹å‘¢ï¼Ÿè®©æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹æ¦‚ç‡è®ºçš„çŸ¥è¯†å§ğŸ˜
è¿™ä¸ªé‡‡æ ·æ–¹æ³•å…¶å®å°±æ˜¯åˆ©ç”¨äº†<strong>é«˜æ–¯åˆ†å¸ƒåœ¨ä»¿å°„å˜æ¢ä¸‹çš„å°é—­æ€§</strong>â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹æ ‡å‡†æ­£æ€å™ªå£°åšä¸€æ¬¡çº¿æ€§å˜æ¢å†åŠ ä¸Šåç§»ï¼Œå¾—åˆ°çš„ä»ç„¶æ˜¯é«˜æ–¯åˆ†å¸ƒï¼Œè€Œä¸”å®ƒçš„å‡å€¼å’Œåæ–¹å·®æ­£å¥½æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p>
<p>æˆ‘ä»¬å…ˆä»æ ‡å‡†å¤šå…ƒæ­£æ€åˆ†å¸ƒä¸­é‡‡æ ·ï¼š<span class="arithmatex">\(\epsilon \sim \mathcal{N}(0, I_d)\)</span>ï¼Œç„¶åå¯¹è¿™ä¸ªå™ªå£°åšä»¿å°„å˜æ¢ï¼š<span class="arithmatex">\(x_t = \alpha_t\,z \;+\;\beta_t\,\epsilon\)</span></p>
<p>ç„¶åæˆ‘ä»¬è®¡ç®—<strong>å‡å€¼ä¸åæ–¹å·®</strong>ã€‚ç”±äº <span class="arithmatex">\(\epsilon\)</span> çš„å‡å€¼ä¸º <span class="arithmatex">\(0\)</span>ï¼Œæ‰€ä»¥</p>
<div class="arithmatex">\[
\mathbb{E}[x_t] = \alpha_t z + \beta_t \mathbb{E}[\epsilon] = \alpha_t z
\]</div>
<p>è€Œ <span class="arithmatex">\(\epsilon\)</span> çš„åæ–¹å·®çŸ©é˜µæ˜¯ <span class="arithmatex">\(I_d\)</span>ï¼Œä»¿å°„å˜æ¢åï¼Œå™ªå£°éƒ¨åˆ†çš„åæ–¹å·®å˜ä¸º</p>
<div class="arithmatex">\[
\text{Cov}(\beta_t \epsilon) = \beta_t^2 \text{Cov}(\epsilon) = \beta_t^2 I_d
\]</div>
<p>åç§»é‡ <span class="arithmatex">\(\alpha_t z\)</span> ï¼ˆåœ¨é€‰æ‹©å¥½ç‰¹å®šçš„ data point åï¼Œå·²ç»å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªå¸¸é‡ï¼Œè€Œå¸¸é‡ä¸å½±å“åæ–¹å·®è®¡ç®—ï¼‰ä¸å½±å“åæ–¹å·®ã€‚</p>
</details>
<p>ç„¶åï¼Œæˆ‘ä»¬ä¹Ÿå·²ç»æœ‰äº†æ¡ä»¶å‘é‡åœºçš„å…¬å¼ï¼š</p>
<div class="arithmatex">\[
u_t^{\text{target}}(x|z) = \left( \dot{\alpha}_t - \frac{\dot{\beta}_t}{\beta_t}\alpha_t \right) z + \frac{\dot{\beta}_t}{\beta_t}x
\]</div>
<p>æŠŠè¿™äº›å…¬å¼ä»£å…¥ <span class="arithmatex">\(\mathcal{L}_{\text{cfm}}(\theta)\)</span> å°±èƒ½å¤Ÿå¾—åˆ°ï¼š</p>
<div class="arithmatex">\[
\begin{align*}
\mathcal{L}_{\text{CFM}}(\theta) &amp;= \mathbb{E}_{t \sim \text{Unif}, z \sim p_{\text{data}}, x \sim \mathcal{N}(\alpha_t z, \beta_t^2 I_d)} \left[ \left\| u_t^{\theta}(x) - \left( \dot{\alpha}_t - \frac{\dot{\beta}_t}{\beta_t}\alpha_t \right)z - \frac{\dot{\beta}_t}{\beta_t}x \right\|^2 \right] \\
&amp;= \mathbb{E}_{t \sim \text{Unif}, z \sim p_{\text{data}}, \epsilon \sim \mathcal{N}(0, I_d)} \left[ \left\| u_t^{\theta}(\alpha_t z + \beta_t\epsilon) - (\dot{\alpha}_t z + \dot{\beta}_t\epsilon) \right\|^2 \right]
\end{align*}
\]</div>
<p>ç‰¹åˆ«åœ°ï¼Œå¦‚æœæˆ‘ä»¬ä»¤ <span class="arithmatex">\(\alpha_t=t,\beta_t=1-t\)</span>ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ›´åŠ ç®€å•çš„ç»“æœï¼š</p>
<div class="arithmatex">\[
\mathcal{L}_{\text{cfm}}(\theta) = \mathbb{E}_{t \sim \text{Unif}, z \sim p_{\text{data}}, \epsilon \sim \mathcal{N}(0, I_d)} \left[ \left\| u_t^{\theta}(tz + (1-t)\epsilon) - (z-\epsilon) \right\|^2 \right]
\]</div>
<p>å¾ˆå¤šçš„ SOTA æ¨¡å‹éƒ½æ˜¯åˆ©ç”¨è¿™ä¸ªç®€å•æœ‰æ•ˆçš„å…¬å¼è®­ç»ƒå‡ºæ¥çš„ã€‚</p>
<p><a class="glightbox" href="../img/image-20250724144053661.webp" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image-20250724144053661" src="../img/image-20250724144053661.webp" /></a></p>
<h2 id="å¾—åˆ†åŒ¹é…-score-matching">å¾—åˆ†åŒ¹é… Score Matching<a class="headerlink" href="#å¾—åˆ†åŒ¹é…-score-matching" title="Permanent link">&para;</a></h2>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»‹ç»<strong>å¾—åˆ†åŒ¹é…ï¼ˆscore matchingï¼‰</strong>å°†ä¸Šé¢çš„æ–¹æ³•æ‰©å±•åˆ° SDEã€‚</p>
<p>æˆ‘ä»¬å†æ¥å›é¡¾ä¸€ä¸‹ ODE æ˜¯å¦‚ä½•æ‰©å±•åˆ° SDE çš„ã€‚</p>
<div class="arithmatex">\[
\begin{align*}
    dX_t &amp;= \left[ u_t^{\text{target}}(X_t) + \frac{\sigma_t^2}{2}\nabla \log p_t(X_t) \right] dt + \sigma_t dW_t \\
    X_0 &amp;\sim p_{\text{init}}, \\
    \Rightarrow X_t &amp;\sim p_t \quad (0 \le t \le 1)
\end{align*}
\]</div>
<p>ä¸Šé¢ï¼Œæˆ‘ä»¬å·²ç»ç»™å‡ºäº†è®­ç»ƒ <span class="arithmatex">\(u_t^{\text{target}}\)</span> çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„é—®é¢˜å°±æ˜¯è¦è®­ç»ƒä¸€ä¸ªæ–°çš„å‚æ•° <span class="arithmatex">\(\nabla\log p_t\)</span>ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªæ–°çš„ç¥ç»ç½‘ç»œâ€”â€”å¾—åˆ†ç½‘ç»œ (score network) <span class="arithmatex">\(s_t^\theta:\mathbb{R}^d\times[0,1]\rightarrow\mathbb{R}^d\)</span> æ¥æ‹Ÿåˆå®ƒã€‚åŒä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆç±»ä¼¼åœ°å¾—åˆ°ï¼ˆæ¡ä»¶ï¼‰å¾—åˆ†åŒ¹é…çš„æŸå¤±å‡½æ•°ï¼š</p>
<div class="arithmatex">\[
\begin{align*}
\mathcal{L}_{\text{SM}}(\theta) &amp;= \mathbb{E}_{t \sim \text{Unif}, z \sim p_{\text{data}}, x \sim p_t(\cdot|z)} [\|s_t^{\theta}(x) - \nabla \log p_t(x)\|^2] \quad \blacktriangleright \text{ score matching loss} \\
\mathcal{L}_{\text{CSM}}(\theta) &amp;= \mathbb{E}_{t \sim \text{Unif}, z \sim p_{\text{data}}, x \sim p_t(\cdot|z)} [\|s_t^{\theta}(x) - \nabla \log p_t(x|z)\|^2] \quad \blacktriangleright \text{ conditional score matching loss}
\end{align*}
\]</div>
<p>åŒæ ·ååˆ†ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨æ¡ä»¶å¾—åˆ†åŒ¹é…æ¥è¿›è¡Œè®­ç»ƒï¼ŒåŸå› ä¹Ÿæ˜¯å› ä¸ºè¿™ä¸ªå¾ˆç±»ä¼¼çš„å®šç†ï¼š</p>
<div class="arithmatex">\[
\mathcal{L}_{\text{SM}}(\theta) = \mathcal{L}_{\text{CSM}}(\theta) + C
\]</div>
<p>å…·ä½“å†…å®¹æˆ‘ä»¬ä¸å†è¯¦ç»†å±•å¼€ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œå½“æˆ‘ä»¬å®Œæˆäº†å¯¹ä¸¤ä¸ªç¥ç»ç½‘ç»œçš„è®­ç»ƒï¼Œåªéœ€è¦å†é€‰æ‹©ä¸€ä¸ªå»å™ªç³»æ•° (diffusion coefficient) <span class="arithmatex">\(\sigma_t\geq0\)</span>ï¼Œå°±èƒ½å¤Ÿæ¨¡æ‹Ÿè¿™ä¸ª SDE äº†ï¼š</p>
<div class="arithmatex">\[
X_0 \sim p_{\text{init}}, \quad dX_t = \left[ u_t^{\theta}(X_t) + \frac{\sigma_t^2}{2} s_t^{\theta}(X_t) \right] dt + \sigma_t dW_t
\]</div>
<p>ç†è®ºä¸Šï¼Œå¦‚æœæˆ‘ä»¬çš„è®­ç»ƒèƒ½å¤Ÿå®ç°æ•°æ®åˆ†å¸ƒçš„å®Œç¾æ‹Ÿåˆï¼Œä»»æ„çš„ä¸€ä¸ª <span class="arithmatex">\(\sigma_t\)</span> éƒ½èƒ½å¤Ÿä¸ºæˆ‘ä»¬ç”Ÿæˆ <span class="arithmatex">\(X_1\sim p_\text{data}\)</span>. ä½†å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°è¿™æ ·ä¸¤ç§è¯¯å·®ï¼š</p>
<ul>
<li><strong>æ•°å€¼è¯¯å·®</strong>ï¼šSDE çš„æ¨¡æ‹Ÿå¹¶ä¸å®Œç¾ï¼›</li>
<li><strong>è®­ç»ƒè¯¯å·®</strong>ï¼š<span class="arithmatex">\(u_t^\theta\)</span> ä¸èƒ½å’Œ target ç™¾åˆ†ç™¾æ‹Ÿåˆã€‚</li>
</ul>
<p>å› æ­¤ï¼Œåœ¨å®æ“æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¾æ®ç»éªŒæŒ‘é€‰ä¸€ä¸ªåˆé€‚çš„å»å™ªç³»æ•°ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™ï¼Œæœ‰äººå¯èƒ½ä¼šè¯´ï¼Œå’Œ flow model ç›¸æ¯”ï¼Œdiffusion model éœ€è¦ä¸€æ¬¡è®­ç»ƒä¸¤ä¸ªå‚æ•°ï¼Œä¸æ˜¯å¾ˆéº»çƒ¦å—ï¼Ÿä½†äº‹å®ä¸Šï¼Œæˆ‘ä»¬é€šå¸¸æŠŠ <span class="arithmatex">\(s_t^\theta, u_t^\theta\)</span> çœ‹åšä¸€ä¸ªç¥ç»ç½‘ç»œçš„ä¸¤ä¸ªè¾“å‡ºï¼Œå› æ­¤å¸¦æ¥çš„é¢å¤–è®¡ç®—å¼€é”€æ˜¯å¯ä»¥æ¥å—çš„ã€‚æ›´è¿›ä¸€æ­¥åœ°ï¼Œæˆ‘ä»¬å³å°†ä»‹ç» DDMï¼Œå®ƒç›´æ¥è§£å†³äº†æˆ‘ä»¬çš„è¿™ä¸ªé—®é¢˜ã€‚</p>
<h2 id="å»å™ªæ‰©æ•£æ¨¡å‹-denoising-diffusion-models">å»å™ªæ‰©æ•£æ¨¡å‹ Denoising Diffusion Models<a class="headerlink" href="#å»å™ªæ‰©æ•£æ¨¡å‹-denoising-diffusion-models" title="Permanent link">&para;</a></h2>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬è€ƒè™‘é«˜æ–¯æ¦‚ç‡è·¯å¾„çš„ç‰¹æ®Šæƒ…å½¢ï¼Œå¼•å‡º<strong>å»å™ªæ‰©æ•£æ¨¡å‹ï¼ˆdenoising diffusion modelsï¼‰ã€‚</strong></p>
<p>åŒæ ·åœ°ï¼Œæˆ‘ä»¬é¦–å…ˆè€ƒè™‘é«˜æ–¯æ¦‚ç‡è·¯å¾„ä¸‹çš„å¾—åˆ†åŒ¹é…æ˜¯æ€ä¹ˆæ ·çš„ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠç‰¹å®šçš„ <span class="arithmatex">\(\nabla\log p_t\)</span> ä»£å…¥æŸå¤±å‡½æ•°å³å¯ï¼š</p>
<div class="arithmatex">\[
\nabla \log p_t(x|z) = - \frac{x - \alpha_t z}{\beta_t^2}
\]</div>
<div class="arithmatex">\[
\begin{align*}
\mathcal{L}_{\text{CSM}}(\theta) &amp;= \mathbb{E}_{t \sim \text{Unif}, z \sim p_{\text{data}}, x \sim p_t(\cdot|z)} \left[ \left\| s_t^{\theta}(x) + \frac{x - \alpha_t z}{\beta_t^2} \right\|^2 \right] \\
&amp;= \mathbb{E}_{t \sim \text{Unif}, z \sim p_{\text{data}}, \epsilon \sim \mathcal{N}(0, I_d)} \left[ \left\| s_t^{\theta}(\alpha_t z + \beta_t \epsilon) + \frac{\epsilon}{\beta_t} \right\|^2 \right] \\
&amp;= \mathbb{E}_{t \sim \text{Unif}, z \sim p_{\text{data}}, \epsilon \sim \mathcal{N}(0, I_d)} \left[ \frac{1}{\beta_t^2} \left\| \beta_t s_t^{\theta}(\alpha_t z + \beta_t \epsilon) + \epsilon \right\|^2 \right]
\end{align*}
\]</div>
<details class="info">
<summary>å…³äº DSM çš„ç”±æ¥</summary>
<p>ç”±äºç½‘ç»œ <span class="arithmatex">\(s_t^\theta\)</span> å®è´¨ä¸Šæ˜¯åœ¨å­¦ä¹ é¢„æµ‹ç”¨äºæ‰°ä¹±æ•°æ®æ ·æœ¬ <span class="arithmatex">\(z\)</span> çš„å™ªå£°ï¼Œå› æ­¤ï¼Œä¸Šè¿°è®­ç»ƒæŸå¤±ä¹Ÿè¢«ç§°ä¸º<strong>å»å™ªå¾—åˆ†åŒ¹é…ï¼ˆdenoising score matchingï¼‰</strong>ï¼Œå®ƒæ˜¯æœ€æ—©ç”¨äºè®­ç»ƒæ‰©æ•£æ¨¡å‹çš„æ–¹æ³•ä¹‹ä¸€ã€‚</p>
</details>
<p>ä½†æˆ‘ä»¬å¾ˆå¿«æ„è¯†åˆ°ï¼Œå½“ <span class="arithmatex">\(\beta_t\approx0\)</span> æ—¶ï¼Œè¿™ä¸ª loss ä¼šå¸¦æ¥æ•°å€¼çˆ†ç‚¸çš„é—®é¢˜ï¼ˆå³ DSM åªåœ¨åŠ å…¥è¶³å¤Ÿå™ªå£°çš„æ—¶å€™æ‰ workï¼‰ã€‚å› æ­¤åœ¨ä¸€äº› DDM çš„å®ç°ä¸­ï¼ˆä¾‹å¦‚ <strong>DDPM</strong>, Denoising Diffusion Probabilitic Modelsï¼‰ï¼Œ<span class="arithmatex">\(\frac{1}{\beta_t^2}\)</span> è¿™ä¸€é¡¹è¢«ä¸¢å¼ƒï¼ŒåŒæ—¶æˆ‘ä»¬æŠŠ <span class="arithmatex">\(s_t^\theta\)</span> æ”¹é€ æˆäº†ä¸€ä¸ªæ–°çš„ç¥ç»ç½‘ç»œï¼ˆæˆ‘ä»¬ç§°ä¸º<strong>å™ªå£°é¢„æµ‹å™¨</strong>ï¼Œnoise predictorï¼‰<span class="arithmatex">\(\epsilon_t^\theta:\mathbb{R}^d\times[0,1]\rightarrow\mathbb{R}^d\)</span>ï¼Œç„¶åå°±å¾—åˆ°äº†å¦‚ä¸‹ç»“æœï¼š</p>
<div class="arithmatex">\[
- \beta_t s_t^{\theta}(x) = \epsilon_t^{\theta}(x) \quad \Rightarrow \quad \mathcal{L}_{\text{DDPM}}(\theta) = \mathbb{E}_{t \sim \text{Unif}, z \sim p_{\text{data}}, \epsilon \sim \mathcal{N}(0, I_d)} [\| \epsilon_t^{\theta}(\alpha_t z + \beta_t \epsilon) - \epsilon \|^2]
\]</div>
<p><a class="glightbox" href="../img/image-20250724151424404.webp" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image-20250724151424404" src="../img/image-20250724151424404.webp" /></a></p>
<p>è¿™ä¸ªæ–°çš„ loss éå¸¸ç®€å•ï¼Œ<strong>ä½†æ›´ magical çš„ç‚¹åœ¨äº</strong>ï¼Œæˆ‘ä»¬åªéœ€è¦è®­ç»ƒ <span class="arithmatex">\(s_t^\theta\)</span> æˆ–è€… <span class="arithmatex">\(\epsilon_t^\theta\)</span> å°±å¤Ÿäº†ï¼Œå› ä¸º <span class="arithmatex">\(u_t^\theta\)</span> å¯ä»¥ç”¨å®ƒæ¨å¯¼å‡ºæ¥ï¼Œåä¹‹äº¦ç„¶ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥å°è¯•è¯´æ˜è¿™ä¸€ç‚¹ï¼ˆå½“ç„¶äº†ï¼Œè¿™ä¸€ç‚¹åªåœ¨é«˜æ–¯æ¦‚ç‡è·¯å¾„çš„å‰æä¸‹æˆç«‹ï¼‰ã€‚</p>
<div class="arithmatex">\[
\begin{align*}
u_t^{\text{target}}(x|z) &amp;= \left( \dot{\alpha}_t - \frac{\dot{\beta}_t}{\beta_t}\alpha_t \right) z + \frac{\dot{\beta}_t}{\beta_t}x \\
&amp;\stackrel{(i)}{=} \left( \beta_t^2\frac{\dot{\alpha}_t}{\alpha_t} - \dot{\beta}_t\beta_t \right) \left( \frac{\alpha_t z - x}{\beta_t^2} \right) + \frac{\dot{\alpha}_t}{\alpha_t}x \\
&amp;= \left( \beta_t^2\frac{\dot{\alpha}_t}{\alpha_t} - \beta_t\dot{\beta}_t \right) \nabla \log p_t(x|z) + \frac{\dot{\alpha}_t}{\alpha_t}x
\end{align*}
\]</div>
<p>æ³¨æ„ï¼Œ<span class="arithmatex">\((i)\)</span> ä¸­çš„æ¨å¯¼åªéœ€è¦æ•°å­¦å˜å½¢å°±èƒ½å¾—åˆ°ï¼Œä¸éœ€è¦é¢å¤–çš„å®šç†ã€‚å¯¹äºè¾¹é™…å‘é‡åœº <span class="arithmatex">\(u_t^{\text{target}}(x)\)</span>ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰å¾ˆç±»ä¼¼çš„ç»“è®ºï¼Œåœ¨æ­¤ä¸å†æ¨å¯¼ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æœ‰äº†å¦‚ä¸‹<strong>éå¸¸æ¼‚äº®çš„ç»“è®º</strong>ï¼š</p>
<div class="arithmatex">\[
u_t^{\theta} = \left( \beta_t^2 \frac{\dot{\alpha}_t}{\alpha_t} - \dot{\beta}_t \beta_t \right) s_t^{\theta}(x) + \frac{\dot{\alpha}_t}{\alpha_t}x
\]</div>
<p>å³è¿™ä¸¤ä¸ªå‚æ•°å¯ä»¥é€šè¿‡çº¿æ€§å˜åŒ–ä¹‹é—´è½¬æ¢ï¼ˆæ³¨æ„ï¼Œå½“æˆ‘ä»¬è€ƒè™‘è¿™é‡Œçš„å‚æ•° <span class="arithmatex">\(\theta\)</span> æ—¶ï¼Œå¯ä»¥æŠŠ <span class="arithmatex">\(t\)</span> å’Œ <span class="arithmatex">\(x\)</span> çœ‹åšå¸¸é‡ï¼‰ã€‚å› æ­¤ï¼Œ<strong>åœ¨é«˜æ–¯æ¦‚ç‡è·¯å¾„çš„æƒ…å†µä¸‹</strong>ï¼ˆæ³¨æ„è¿™ä¸ªå‰ææ¡ä»¶ï¼‰ï¼Œæˆ‘ä»¬åªéœ€è¦è®­ç»ƒä¸€ä¸ªå‚æ•°ï¼ˆä»»æ„é€‰æ‹© flow matching æˆ–è€… score matching çš„æ–¹æ³•ï¼‰ï¼Œå°±å¯ä»¥å®ç° SDE çš„é‡‡æ ·ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åªéœ€è¦è®­ç»ƒ <span class="arithmatex">\(s_t^\theta\)</span>ï¼Œå°±å¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼æ¥å®Œæˆ samplingï¼š</p>
<div class="arithmatex">\[
X_0 \sim p_{\text{init}}, \quad dX_t = \left[ \left( \beta_t^2 \frac{\dot{\alpha}_t}{\alpha_t} - \dot{\beta}_t\beta_t + \frac{\sigma_t^2}{2} \right) s_t^{\theta}(x) + \frac{\dot{\alpha}_t}{\alpha_t}x \right] dt + \sigma_t dW_t
\]</div>
<h2 id="å¦‚ä½•é˜…è¯»-diffusion-model-çš„æ–‡çŒ®">å¦‚ä½•é˜…è¯» Diffusion Model çš„æ–‡çŒ®ï¼Ÿ<a class="headerlink" href="#å¦‚ä½•é˜…è¯»-diffusion-model-çš„æ–‡çŒ®" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">å£°æ˜</p>
<p>ç”±äºéƒ¨åˆ†æœ¯è¯­çš„ä¸­æ–‡ç¿»è¯‘æœ‰äº›æ‰æ€¥/å‡ºæˆï¼Œæˆ‘ä»¬é‡‡ç”¨ä¸­è‹±å¤¹æ‚çš„æ–¹å¼æ¥è®²è¿°è¿™ä¸€éƒ¨åˆ†çš„å†…å®¹ã€‚</p>
</div>
<h3 id="ç¦»æ•£æ—¶é—´-vs-è¿ç»­æ—¶é—´">ç¦»æ•£æ—¶é—´ vs è¿ç»­æ—¶é—´<a class="headerlink" href="#ç¦»æ•£æ—¶é—´-vs-è¿ç»­æ—¶é—´" title="Permanent link">&para;</a></h3>
<p>æ—©æœŸçš„å»å™ªæ‰©æ•£æ¨¡å‹ï¼ˆDDPMï¼‰ï¼Œé‡‡ç”¨ç¦»æ•£é©¬å°”å¯å¤«é“¾ï¼Œå°†æ—¶åˆ» <span class="arithmatex">\(t\)</span> é‡åŒ–ä¸ºæ•´æ•°ï¼š<span class="arithmatex">\(0,â€¯1,â€¯2,â€¯â€¦\)</span>ã€‚è¿™ç§åšæ³•ç›´è§‚æ˜“æ‡‚ï¼Œä½†å­˜åœ¨ä¸¤ä¸ªä¸»è¦ç¼ºç‚¹ï¼š</p>
<ol>
<li>åœ¨è®­ç»ƒå‰å¿…é¡»<strong>é¢„å…ˆé€‰å®šæ—¶é—´æ­¥æ•°</strong>åŠå…¶ç¦»æ•£æ–¹æ¡ˆã€‚</li>
<li>ä½¿ç”¨ ELBOï¼ˆevidence lower boundï¼‰è¿‘ä¼¼ä¼˜åŒ–ç›®æ ‡ï¼Œè¯¥ä¸‹ç•Œåœ¨ç¦»æ•£æƒ…å½¢ä¸‹<strong>å¹¶éä¸¥æ ¼ç­‰ä»·äºæˆ‘ä»¬çœŸæ­£æƒ³æœ€å°åŒ–çš„æŸå¤±</strong>ã€‚</li>
</ol>
<p>åæ¥ï¼Œæˆ‘ä»¬å‘ç°ï¼Œç¦»æ•£æ—¶é—´æ¡†æ¶å…¶å®æ˜¯å¯¹è¿ç»­æ—¶é—´ SDE çš„è¿‘ä¼¼ï¼Œè€Œä¸¤è€…å¹¶æ²¡æœ‰æœ¬è´¨æ„ä¹‰ä¸Šçš„ä¸åŒã€‚</p>
<p>æˆ‘ä»¬æ˜¯é‡‡ç”¨çš„ SDE æ„é€ æ–¹æ³•åœ¨æ•°å­¦æ„ä¹‰ä¸Šæ›´åŠ ç®€æ´ã€‚</p>
<h3 id="æ­£å‘è¿‡ç¨‹-vs-æ¦‚ç‡è·¯å¾„">"æ­£å‘è¿‡ç¨‹" vs æ¦‚ç‡è·¯å¾„<a class="headerlink" href="#æ­£å‘è¿‡ç¨‹-vs-æ¦‚ç‡è·¯å¾„" title="Permanent link">&para;</a></h3>
<p>å…ˆè¯´ç»“è®ºï¼š<strong>forward process æ˜¯æ„é€ ï¼ˆé«˜æ–¯ï¼‰æ¦‚ç‡è·¯å¾„çš„ç‰¹æ®Šæ–¹å¼</strong>ã€‚</p>
<p>å®ƒé€šå¸¸ä»¥ <strong>inverted time convention</strong> çš„å½¢å¼è¿›è¡Œæ„é€ ï¼š</p>
<div class="arithmatex">\[
\bar{X}_0 = z, \quad d\bar{X}_t = u_t^{\text{forw}}(\bar{X}_t)dt + \sigma_t^{\text{forw}}d\bar{W}_t
\]</div>
<p>å®ƒçš„å¤§è‡´æƒ³æ³•æ˜¯åœ¨ä¸€å¼€å§‹é€‰å–ä¸€ä¸ªæ•°æ®ç‚¹ <span class="arithmatex">\(z\sim p_\text{data}\)</span>ï¼Œç„¶åé€šè¿‡ä¸æ–­åŠ å™ªå£°çš„æ–¹å¼æ¥<strong>â€æ±¡æŸ“â€œ</strong>è¿™ä¸ªæ•°æ®ã€‚è€Œå½“ <span class="arithmatex">\(T\rightarrowâˆ\)</span>ï¼Œå®ƒçš„åˆ†å¸ƒä¼šè¶‹è¿‘ <span class="arithmatex">\(p_\text{data}\)</span>. è€Œè¿™ä¸€æƒ³æ³•å’Œæ¦‚ç‡è·¯å¾„åœ¨æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯æŠŠè·¯å¾„åäº†è¿‡æ¥ï¼Œå³å˜æˆäº† <span class="arithmatex">\(\bar{X}_0 = z\)</span>.</p>
<h3 id="æ—¶é—´åè½¬-vs-fokker-planck-æ–¹ç¨‹">æ—¶é—´åè½¬ vs Fokker-Planck æ–¹ç¨‹<a class="headerlink" href="#æ—¶é—´åè½¬-vs-fokker-planck-æ–¹ç¨‹" title="Permanent link">&para;</a></h3>
<p>æˆ‘ä»¬æœ‰ä¸åŒçš„æ„é€  training target çš„æ–¹å¼ã€‚åœ¨æœ¬æ–‡æ¡£çš„æ¡†æ¶ä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Fokker-Planck equation (or Continuity equation) çš„æ–¹å¼ï¼Œä½†æœ‰å…¶ä»–æ–¹æ³•æ˜¯é€šè¿‡ <strong>time-reversal</strong> of the forward process çš„æ–¹å¼æ¥æ„é€ çš„ã€‚</p>
<h3 id="æµåŒ¹é…ä¸éšæœºæ’å€¼å™¨">æµåŒ¹é…ä¸éšæœºæ’å€¼å™¨<a class="headerlink" href="#æµåŒ¹é…ä¸éšæœºæ’å€¼å™¨" title="Permanent link">&para;</a></h3>
<p>æˆ‘ä»¬åœ¨è¿™é‡Œä»‹ç»çš„ç†è§£ diffusion çš„æ¡†æ¶å’Œ <strong>flow matching &amp; stochastic interpolants (SIs)</strong> çš„æ¡†æ¶æœ€ä¸ºæ¥è¿‘ã€‚</p>
<p>åœ¨ flow matching ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦ forward process å’Œ SDE å°±èƒ½å®ç°æµæ¨¡å‹çš„è®­ç»ƒï¼Œä¹Ÿå› ä¸ºè¿™ä¸€ç‚¹ï¼Œä»æµæ¨¡å‹ä¸­çš„é‡‡æ ·æ˜¯ç¡®å®šæ€§çš„ï¼ˆå³é™¤äº†åˆå§‹åˆ†å¸ƒ <span class="arithmatex">\(X_0\sim p_{\text{init}}\)</span> æ˜¯éšæœºçš„ï¼Œå…¶ä»–éƒ½æ˜¯ç¡®å®šçš„ï¼‰ã€‚</p>
<p>è€Œ stochastic interpolants åˆ™åŒæ—¶åŒ…å«äº† pure flow å’Œ SDE extension (æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚è®²è¿°çš„)ã€‚<strong>è¿™ä¸ªæ¡†æ¶ç›¸æ¯”æ‰©æ•£æ¨¡å‹è¿™ä¸€å•ä¸€è¯´æ³•è€Œè¨€æ›´ç®€æ´ä¹Ÿæ›´å…·æ™®éæ€§</strong>ï¼šæˆ‘ä»¬å¯ä»¥å®ç°ä»ä»»æ„åˆ†å¸ƒ <span class="arithmatex">\(p_\text{init}\)</span> åˆ°ä»»æ„åˆ†å¸ƒ <span class="arithmatex">\(p_\text{data}\)</span> çš„è½¬æ¢ï¼ˆè€Œ denoising diffusion models åªèƒ½åœ¨é«˜æ–¯åˆ†å¸ƒä½œä¸ºåˆå§‹æ¡ä»¶ä¸‹æ‰èƒ½ workï¼‰ã€‚</p>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="æœ€åæ›´æ–°">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="2025å¹´8æœˆ3æ—¥ 08:48:21 UTC">2025å¹´8æœˆ3æ—¥</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="åˆ›å»ºæ—¥æœŸ">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="2025å¹´8æœˆ3æ—¥ 08:48:21 UTC">2025å¹´8æœˆ3æ—¥</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  å›åˆ°é¡µé¢é¡¶éƒ¨
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="é¡µè„š" >
        
          
          <a href="../lec2/" class="md-footer__link md-footer__link--prev" aria-label="ä¸Šä¸€é¡µ: Lec2: Constructing a Training Target">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                ä¸Šä¸€é¡µ
              </span>
              <div class="md-ellipsis">
                Lec2: Constructing a Training Target
              </div>
            </div>
          </a>
        
        
          
          <a href="../lec4/" class="md-footer__link md-footer__link--next" aria-label="ä¸‹ä¸€é¡µ: Lec4: Building an Image Generator">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                ä¸‹ä¸€é¡µ
              </span>
              <div class="md-ellipsis">
                Lec4: Building an Image Generator
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright Â© HarryZ
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "content.code.select", "content.code.annotate", "navigation.footer", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.tracking", "navigation.path", "navigation.top", "toc.follow", "content.action.view", "search.suggest", "search.highlight", "search.share"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/polyfill/index.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.js"></script>
      
        <script src="../../../javascripts/tablesort.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/tablesort/dist/tablesort.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>